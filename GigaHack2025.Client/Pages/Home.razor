@page "/"

<PageTitle>Dashboard</PageTitle>

<div class="welcome-section">
    <div class="welcome-header">
        <h1>Welcome back, John 👋</h1>
        <div class="profile-completion-bar">
            <div class="completion-progress">
                <div class="progress-container">
                    <div class="progress-bar" style="width: @(ProfileCompletionPercentage)%; background-color: @GetProgressColor(ProfileCompletionPercentage)"></div>
                </div>
                <div class="completion-text">
                    <span class="percentage">@(ProfileCompletionPercentage)% completed</span>
                    <button class="btn-complete" @onclick="CompleteProfile">Get help to complete</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="services-dashboard">
    <div class="services-grid">
        <div class="service-card" @onclick="NavigateToSubsidies">
            <div class="card-image" style="background-image: url('images/subsidies.jpg');">
            </div>
            <div class="card-content">
                <h3>Subsidies & Grants</h3>
            </div>
        </div>

        <div class="service-card" @onclick="NavigateToLoans">
            <div class="card-image" style="background-image: url('images/loans.jpg');">
            </div>
            <div class="card-content">
                <h3>Loans & Insurance</h3>
            </div>
        </div>

        <div class="service-card" @onclick="NavigateToCertification">
            <div class="card-image" style="background-image: url('images/certification.jpg');">
            </div>
            <div class="card-content">
                <h3>Certification Services</h3>
            </div>
        </div>

        <div class="service-card" @onclick="NavigateToMarket">
            <div class="card-image" style="background-image: url('images/market.jpg');">
            </div>
            <div class="card-content">
                <h3>Needs of the market</h3>
            </div>
        </div>

        <div class="service-card" @onclick="NavigateToOffers">
            <div class="card-image" style="background-image: url('images/offers.jpg');">
            </div>
            <div class="card-content">
                <h3>Supper Offers</h3>
            </div>
        </div>

        <div class="service-card" @onclick="NavigateToHelp">
            <div class="card-image" style="background-image: url('images/help.jpg');">
            </div>
            <div class="card-content">
                <h3>Help Exchange</h3>
            </div>
        </div>
    </div>
</div>

@inject NavigationManager Navigation

@code {
    private int ProfileCompletionPercentage = 20; // You can make this dynamic

    private void NavigateToSubsidies() => Navigation.NavigateTo("/subsidies");
    private void NavigateToLoans() => Navigation.NavigateTo("/loans");
    private void NavigateToCertification() => Navigation.NavigateTo("/certification");
    private void NavigateToMarket() => Navigation.NavigateTo("/market");
    private void NavigateToOffers() => Navigation.NavigateTo("/offers");
    private void NavigateToHelp() => Navigation.NavigateTo("/help");

    private void CompleteProfile()
    {
        // Navigate to profile completion page or show modal
        Navigation.NavigateTo("/profile-setup");
    }

    private string GetProgressColor(int percentage)
    {
        // Interpolate between red (#ff4c4c) and green (#24a529)
        var progress = percentage / 100.0;
        
        // Red color components
        var startR = 255;
        var startG = 76;
        var startB = 76;
        
        // Green color components
        var endR = 36;
        var endG = 165;
        var endB = 41;
        
        // Interpolate
        var r = (int)(startR + (endR - startR) * progress);
        var g = (int)(startG + (endG - startG) * progress);
        var b = (int)(startB + (endB - startB) * progress);
        
        return $"rgb({r}, {g}, {b})";
    }
}
